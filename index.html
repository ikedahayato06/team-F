<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
   <title>Sample Map</title>
   <script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAMb-nfDy9Nw5rxM7k9e7D8BiBZi2Wrciw&callback=initMap"></script>

   <style type="text/css">
      #map_canvas {
         width: 100%;
         height:50%;
      }
      html, body {
         height: 100%;
         margin: 0;
         padding: 0;
      }
   </style>

   <script type="text/javascript">
      var map;
      var marker;
      var circle;
      var id;

      function initMap() {
         var myLatlng = new google.maps.LatLng(35.683755, 139.745625);
         var mapOptions = {
            zoom: 14,
            center: myLatlng
         };
         map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);

         // CSVファイルのURL
         var csvFile = "https://github.com/project-team-F/team-F/blob/main/data.csv";

         // CSVデータを読み込んでマーカーを表示
         loadCSVDataAndAddMarkers(csvFile);
      }

      function loadCSVDataAndAddMarkers(csvFile) {
         fetch(csvFile)
            .then(response => response.text())
            .then(data => {
               var rows = data.split("\n");

               for (var i = 1; i < rows.length; i++) {
                  var cols = rows[i].split("\t"); // タブで列を分割
                  var latitude = parseFloat(cols[0].replace(/\./g, '.'));
                  var longitude = parseFloat(cols[1].replace(/\./g, '.'));

                  if (!isNaN(latitude) && !isNaN(longitude)) {
                     var location = new google.maps.LatLng(latitude, longitude);
                     var marker = new google.maps.Marker({
                        position: location,
                        map: map
                     });

                     // テーブルにデータを追加
                     setInfo("Timestamp", latitude, longitude, "0m");
                  }
               }
            });
      }

      function setInfo(timeStamp, latitude, longitude, accuracy) {
         var tableRef = document.getElementById('tblGps');
         var newRow = tableRef.insertRow(1);
         var newCellTime = newRow.insertCell(0);
         var newCellLat = newRow.insertCell(1);
         var newCellLng = newRow.insertCell(2);
         var newCellAcr = newRow.insertCell(3);
         newCellTime.innerHTML = timeStamp;
         newCellLat.innerHTML = latitude;
         newCellLng.innerHTML = longitude;
         newCellAcr.innerHTML = accuracy;
      }
   </script>
</head>
<body>
   <div id="map_canvas"></div>
   <br /><input type="button" value="追跡開始" onclick="startWatchPosition();" />
   <br /><input type="button" value="追跡終了" onclick="clearWatchPosition();" />
   <p>
      <table  style="width:100%">
         <tr><th>エラーコード</th><td id="tdErrCd"></td></tr>
         <tr><th>エラーメッセージ</th><td id="tdErrMg"></td></tr>
      </table>
      <table style="width:100%" id="tblGps">
         <tr>
            <th>タイムスタンプ</th>
            <th>緯度</th>
            <th>経度</th>
            <th>位置（正確さ）</th>
         </tr>
      </table>
   </p>
</body>
</html>
